(() => {
(()=>{var u=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var h=u((b,E)=>{if(!window?.location?.href||!window.location.href.startsWith("https://my.ucdavis.edu/schedulebuilder/"))throw alert("This bookmarklet only works on the UCD Schedule Builder page (https://my.ucdavis.edu/schedulebuilder/)."),new Error("Not on UCD Schedule Builder page");var C=(()=>{let e=[],t=schedule.currSched.get(),r=CourseDetails[[Object.keys(CourseDetails)[0]]].COURSE_MATERIALS_TERM;for(let s in t)if(t[s].STORED_REGISTRATION_STATUS==="Registered"){let i=CourseDetails[s];e.push({title:`${i.SUBJECT_CODE} ${i.COURSE_NUMBER} ${i.SECTION_NUMBER} - ${i.TITLE}`,meetings:i.MEETINGS,finalExamDate:i.FINAL_EXAM_STARTDATE,dropDate:i.DROP_DATE,allowedDropDesc:i.ALLOWED_DROP_DESC,description:i.DESCRIPTION})}return{course_list:e,term:r}})();E.exports={courses:C}});var D=u((A,T)=>{var l=class e{#t;#i;#e;#s;#n;#r;static formatICalString(t){return`${t.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n")}`.match(/.{1,75}/g).map((i,n)=>n===0?i:" "+i).join(`\r
`)}static utcToLocalISOString(t){let r=new Date(t),s=$=>String($).padStart(2,"0"),i=r.getFullYear(),n=s(r.getMonth()+1),a=s(r.getDate()),f=s(r.getHours()),w=s(r.getMinutes()),I=s(r.getSeconds());return`${i}-${n}-${a}T${f}:${w}:${I}`}static findFirstMatchingWeekday(t,r){let s={MO:1,TU:2,WE:3,TH:4,FR:5},i=r.map(a=>s[a]),n=t;for(;!i.includes(n.getDay());)n.setDate(n.getDate()+1);return n}setTitle(t){if(!t||typeof t!="string")throw new Error("CalendarEventBuilder.setTitle: title must be a non-empty string");return this.#t=e.formatICalString(t),this}setStartTime(t){if(!(t instanceof Date)||isNaN(t))throw new Error("CalendarEventBuilder.setStartTime: startTime must be a valid Date object");return this.#i=t,this}setEndTime(t){if(!(t instanceof Date)||isNaN(t))throw new Error("CalendarEventBuilder.setEndTime: endTime must be a valid Date object");return this.#e=t,this}setLocation(t){if(!t||typeof t!="string")throw new Error("CalendarEventBuilder.setLocation: location must be a non-empty string");return this.#s=e.formatICalString(t),this}setDescription(t){if(!t||typeof t!="string")throw new Error("CalendarEventBuilder.setDescription: description must be a non-empty string");return this.#n=e.formatICalString(t),this}setDays(t){if(!Array.isArray(t)||t.some(r=>typeof r!="string"||r.length!==1))throw new Error("CalendarEventBuilder.setDays: days must be an array of single-character strings");return this.#r=t.map(r=>{switch(r){case"M":return"MO";case"T":return"TU";case"W":return"WE";case"R":return"TH";case"F":return"FR";default:throw new Error(`CalendarEventBuilder.setDays: invalid or non-supported day character '${r}'`)}}),this}build(){let t=new Date(this.#i),r=Intl.DateTimeFormat().resolvedOptions().timeZone;return t.setHours(this.#e.getHours(),this.#e.getMinutes(),this.#e.getSeconds()),["BEGIN:VEVENT",`SUMMARY:${this.#t}`,`DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").split(".")[0]}Z`,`UID:${crypto.randomUUID()}`,`${this.#r?`DTSTART;TZID=${r}:${e.utcToLocalISOString(e.findFirstMatchingWeekday(this.#i,this.#r).toISOString()).replace(/[-:]/g,"").split(".")[0]}`:`DTSTART;TZID=${r}:${e.utcToLocalISOString(this.#i).replace(/[-:]/g,"").split(".")[0]}`}`,`DTEND;TZID=${r}:${e.utcToLocalISOString(t.toISOString()).replace(/[-:]/g,"").split(".")[0]}`,`${this.#s?`LOCATION:${this.#s}`:""}`,`DESCRIPTION:${this.#n}`,`${this.#r?`RRULE:FREQ=WEEKLY;BYDAY=${this.#r.join(",")};UNTIL=${this.#e.toISOString().replace(/[-:]/g,"").split(".")[0]}Z`:""}`,"END:VEVENT"].filter(s=>s!=="").join(`\r
`)}},c=class{#t=[];addEvent(t){if(t=t.trim(),console.log(t),typeof t!="string"||!t.startsWith("BEGIN:VEVENT")||!t.endsWith("END:VEVENT"))throw new Error("CalendarBuilder.addEvent: event must be a valid VEVENT string");return this.#t.push(t),this}build(){return["BEGIN:VCALENDAR","VERSION:2.0","CALSCALE:GREGORIAN",...this.#t,"END:VCALENDAR"].filter(t=>t!=="").join(`\r
`)}};T.exports={CalendarEventBuilder:l,CalendarBuilder:c}});var{courses:{course_list:p,term:m}}=h(),{CalendarBuilder:N,CalendarEventBuilder:g}=D();if(!window?.location?.href||!window.location.href.startsWith("https://my.ucdavis.edu/schedulebuilder/"))throw alert("This bookmarklet only works on the UCD Schedule Builder page (https://my.ucdavis.edu/schedulebuilder/)."),new Error("Not on UCD Schedule Builder page");var d=new N;for(let e of p){for(let t of e.meetings){if(t.STARTTIME==null||t.ENDTIME==null){console.warn(`Skipping meeting for course ${e.title} due to missing start or end time.`);continue}d.addEvent(new g().setTitle(e.title+` (${t.TYPE})`).setStartTime(t.STARTTIME).setEndTime(t.ENDTIME).setLocation(t.LOCATION).setDescription(`Last date to drop: ${e.dropDate.toLocaleString().split(",")[0]}

${e.description}`).setDays(t.WEEKDAYS.split(",")).build())}e.finalExamDate!=null&&d.addEvent(new g().setTitle(e.title+" (Final Exam)").setStartTime(e.finalExamDate).setEndTime(new Date(e.finalExamDate.getTime()+7200*1e3)).setDescription(`Final Exam for ${e.title}

${e.description}`).build())}var R=d.build(),y=new Blob([R],{type:"text/calendar"}),S=URL.createObjectURL(y),o=document.createElement("a");o.href=S;o.download=`ucd_schedule_${m.replace(" ","_")}.ics`;document.body.appendChild(o);o.click();document.body.removeChild(o);URL.revokeObjectURL(S);console.log(`Exported ${p.length} courses for term ${m}`);})();
})();
